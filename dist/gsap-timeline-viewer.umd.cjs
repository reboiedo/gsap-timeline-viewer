(function(v,h){typeof exports=="object"&&typeof module<"u"?h(exports):typeof define=="function"&&define.amd?define(["exports"],h):(v=typeof globalThis<"u"?globalThis:v||self,h(v.GSAPTimelineViewer={}))})(this,function(v){"use strict";var Z=Object.defineProperty;var Q=(v,h,w)=>h in v?Z(v,h,{enumerable:!0,configurable:!0,writable:!0,value:w}):v[h]=w;var o=(v,h,w)=>Q(v,typeof h!="symbol"?h+"":h,w);let h=0,w=null;function R(l){w=l}function z(l){if(!l||l.length===0)return"Unknown";const n=l[0];return n.id?`#${n.id}`:n.classList&&n.classList.length>0?`.${n.classList[0]}`:n.tagName?n.tagName.toLowerCase():"element"}function j(l){const n=["ease","duration","delay","onComplete","onStart","onUpdate","onCompleteParams","onStartParams","onUpdateParams","repeat","repeatDelay","yoyo","stagger","overwrite","immediateRender","lazy","autoAlpha","id","paused","reversed","startAt"];return Object.keys(l).filter(t=>!n.includes(t))}function N(l=50){const n=[];for(let t=0;t<=l;t++)n.push(t/l);return n}function G(l,n,t=50){var s;const e=w||window.gsap;let i=(s=e==null?void 0:e.parseEase)==null?void 0:s.call(e,l.trim());if(!i&&n&&(i=n._ease),!i)return N(t);const a=[];for(let r=0;r<=t;r++)a.push(i(r/t));return a}function V(l){const n=[];l.getChildren(!0,!0,!1).forEach((e,i)=>{if(!("targets"in e))return;const a=e,s=a.targets(),r=a.vars||{},c=j(r);let p="";if(r.id&&typeof r.id=="string")p=r.id;else{const y=z(s),x=c.slice(0,2).join(", ");p=x?`${y} (${x})`:y}const g=e.startTime(),u=e.duration();let k="power1.out";r.ease&&(k=typeof r.ease=="string"?r.ease:"custom");let m,f;if(r.stagger&&s.length>1&&(typeof r.stagger=="number"?m=r.stagger:typeof r.stagger=="object"&&(m=r.stagger.each||0),m)){const y=u-m*(s.length-1);f=s.map((x,L)=>{const S=g+L*m;return{targetLabel:z([x]),startTime:S,endTime:S+y}})}n.push({id:`tween-${++h}`,label:p,startTime:g,endTime:g+u,duration:u,targets:z(s),properties:c,colorIndex:i%6,hasStagger:!!r.stagger,ease:k,easeSamples:G(k,a),staggerValue:m,staggerChildren:f})});for(let e=1;e<n.length;e++){const i=n[e-1],a=n[e],s=i.endTime-a.startTime;Math.abs(s)>.001&&(a.overlapWithPrev=Math.round(s*1e3)/1e3)}return{duration:l.duration(),tweens:n}}function _(){h=0}function P(l,n=!0){const t=Math.abs(l);return n?t.toFixed(2):t.toFixed(0)}const O=":host{--gtv-bg: #2a2a2a;--gtv-bg-card: #1a1a1a;--gtv-border: #333;--gtv-text: #e0e0e0;--gtv-text-muted: #888;--gtv-accent: oklch(65% .15 220);--gtv-playhead: oklch(65% .15 220);--gtv-track-height: 36px;--gtv-controls-height: 40px;--gtv-ruler-height: 24px;--gtv-timeline-padding: 16px;--gtv-track-1: oklch(50% .12 220);--gtv-track-1-active: oklch(60% .15 220);--gtv-track-2: oklch(50% .12 70);--gtv-track-2-active: oklch(60% .15 70);--gtv-track-3: oklch(50% .12 350);--gtv-track-3-active: oklch(60% .15 350);--gtv-track-4: oklch(50% .12 160);--gtv-track-4-active: oklch(60% .15 160);--gtv-track-5: oklch(50% .12 290);--gtv-track-5-active: oklch(60% .15 290);--gtv-track-6: oklch(50% .12 25);--gtv-track-6-active: oklch(60% .15 25)}*{box-sizing:border-box;margin:0;padding:0}.gtv-container{position:fixed;bottom:0;left:0;right:0;background:var(--gtv-bg);border-top:1px solid var(--gtv-border);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;font-size:12px;color:var(--gtv-text);z-index:999999;display:flex;flex-direction:column;user-select:none;-webkit-user-select:none}.gtv-container.collapsed{height:auto!important}.gtv-container.collapsed .gtv-timeline-area{display:none}.gtv-controls{position:relative;display:flex;align-items:center;justify-content:center;height:var(--gtv-controls-height);padding:0 12px;background:var(--gtv-bg);gap:8px}.gtv-controls-left{position:absolute;left:12px;display:flex;align-items:center;gap:8px}.gtv-controls-center{display:flex;align-items:center;gap:8px}.gtv-controls-right{position:absolute;right:12px;display:flex;align-items:center;gap:8px}.gtv-time-display{font-variant-numeric:tabular-nums;min-width:100px;text-align:center}.gtv-time-current{color:var(--gtv-text)}.gtv-time-total{color:var(--gtv-text-muted)}.gtv-btn{display:flex;align-items:center;justify-content:center;width:28px;height:28px;background:transparent;border:none;border-radius:4px;color:var(--gtv-text);cursor:pointer;transition:background .15s}.gtv-btn:hover{background:#ffffff1a}.gtv-btn:active{background:#ffffff26}.gtv-btn.active{color:var(--gtv-accent)}.gtv-btn svg{width:16px;height:16px;fill:currentColor}.gtv-btn-play svg{width:20px;height:20px}.gtv-speed-btn{width:auto;padding:0 8px;font-size:11px;font-weight:500}.gtv-timeline-select{background:var(--gtv-bg-card);border:1px solid var(--gtv-border);border-radius:4px;color:var(--gtv-text);font-size:11px;padding:4px 8px;cursor:pointer;max-width:140px}.gtv-timeline-select:focus{outline:none;border-color:var(--gtv-accent)}.gtv-collapse-btn{margin-left:auto}.gtv-playrange-bar{position:relative;height:16px;background:var(--gtv-bg);padding:2px calc(var(--gtv-timeline-padding) + 8px);margin-bottom:8px}.gtv-playrange-track{position:relative;height:100%;width:100%;background:#0000004d;border-radius:0}.gtv-playrange-inactive-left,.gtv-playrange-inactive-right{position:absolute;top:0;height:100%;background:var(--gtv-bg);opacity:.5;pointer-events:none}.gtv-playrange-inactive-left{left:0;width:0%}.gtv-playrange-inactive-right{right:0;width:0%}.gtv-playrange-active{position:absolute;top:0;left:0;width:100%;height:100%;background:#00000026;pointer-events:none;border-radius:0}.gtv-playrange-handle{position:absolute;top:2px;bottom:2px;width:8px;cursor:ew-resize;z-index:5;background:#5ba3d0;border-radius:3px}.gtv-playrange-handle:hover{background:#7cbce8}.gtv-playrange-handle-start{transform:translate(-100%);border-top-right-radius:0;border-bottom-right-radius:0}.gtv-playrange-handle-end{border-top-left-radius:0;border-bottom-left-radius:0}.gtv-timeline-area{position:relative;display:flex;flex-direction:column;overflow:hidden;flex:1;background:var(--gtv-bg-card);border-radius:8px 8px 0 0;margin:0 8px}.gtv-resize-handle{position:absolute;top:0;left:0;right:0;height:8px;cursor:ns-resize;z-index:100}.gtv-resize-handle:hover,.gtv-resize-handle:active{background:#ffffff14}.gtv-ruler{position:relative;height:var(--gtv-ruler-height);background:var(--gtv-bg-card);border-bottom:1px solid var(--gtv-border);overflow:visible;flex-shrink:0;padding:0 var(--gtv-timeline-padding)}.gtv-ruler-inner{position:relative;height:100%;width:100%}.gtv-ruler-marker{position:absolute;top:0;display:flex;flex-direction:column;align-items:flex-start;transform:translate(-.5px)}.gtv-ruler-marker-line{width:1px;height:6px;background:var(--gtv-text-muted)}.gtv-ruler-marker-label{font-size:10px;color:var(--gtv-text-muted);margin-top:2px}.gtv-grid-line{position:absolute;top:0;width:1px;height:100%;background:var(--gtv-border);pointer-events:none}.gtv-tracks-container{position:relative;overflow-y:auto;overflow-x:hidden;flex:1;padding:0 var(--gtv-timeline-padding)}.gtv-tracks-scroll{position:relative;min-height:100%;width:100%}.gtv-track{position:relative;padding-top:var(--gtv-track-height)}.gtv-track-bar{position:absolute;top:4px;height:calc(var(--gtv-track-height) - 8px);border-radius:4px;display:flex;align-items:center;justify-content:space-between;gap:8px;padding:0 8px;font-size:11px;font-weight:500;color:#fff;overflow:hidden;cursor:default;transition:filter .15s}.gtv-track-label{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex:1;min-width:0;position:relative;z-index:1}.gtv-track-stagger{font-size:10px;font-weight:400;flex-shrink:0;position:relative;z-index:1}.gtv-track-bar:hover{filter:brightness(1.1)}.gtv-ease-curve{position:absolute;top:0;right:0;bottom:0;left:0;width:100%;height:100%;pointer-events:none;opacity:0;transition:opacity .15s}.gtv-ease-stroke{fill:none;stroke:oklch(75% .12 var(--track-hue, 220));stroke-width:2;stroke-linecap:round;stroke-linejoin:round;vector-effect:non-scaling-stroke}.gtv-container.show-ease-curves .gtv-ease-curve{opacity:1}.gtv-container.show-ease-curves .gtv-track-bar,.gtv-container.show-ease-curves .gtv-stagger-child-bar{background:transparent!important;border-radius:0;overflow:visible}.gtv-container.show-ease-curves .gtv-track-label{text-shadow:0 1px 3px rgba(0,0,0,.8)}.gtv-playhead-wrapper{position:absolute;top:0;bottom:0;left:var(--gtv-timeline-padding);right:var(--gtv-timeline-padding);pointer-events:none;z-index:15}.gtv-playhead{position:absolute;top:0;bottom:0;width:0;left:0}.gtv-playhead-head{position:absolute;top:6px;left:-5px;width:11px;height:11px;background:var(--gtv-playhead);clip-path:polygon(50% 100%,0 0,100% 0)}.gtv-playhead-line{position:absolute;top:6px;bottom:0;left:0;width:1px;background:var(--gtv-playhead)}.gtv-scrub-area{position:absolute;top:0;left:0;right:0;bottom:0;cursor:ew-resize}.gtv-track[data-expandable=true] .gtv-track-bar{cursor:pointer}.gtv-expand-icon{transition:transform .2s}.gtv-track.expanded .gtv-expand-icon{transform:rotate(180deg)}.gtv-stagger-children{display:none;position:relative;width:100%}.gtv-track.expanded .gtv-stagger-children{display:block}.gtv-stagger-child{position:relative;width:100%;height:calc(var(--gtv-track-height) - 6px)}.gtv-stagger-child-bar{position:absolute;top:2px;height:calc(var(--gtv-track-height) - 12px);border-radius:3px;display:flex;align-items:center;padding:0 6px;font-size:10px;color:#fff;overflow:hidden}.gtv-stagger-child-bar .gtv-track-label{overflow:hidden;position:relative;z-index:1;text-overflow:ellipsis;white-space:nowrap}.gtv-overlap-region{position:absolute;top:4px;height:calc(var(--gtv-track-height) - 8px);background:repeating-linear-gradient(-45deg,transparent,transparent 2px,rgba(255,255,255,.15) 2px,rgba(255,255,255,.15) 4px);border-radius:4px;pointer-events:none;z-index:5}.gtv-container.show-ease-curves .gtv-overlap-region{display:none}.gtv-gap-connector{position:absolute;top:50%;height:1px;border-top:1px dashed var(--gtv-text-muted);pointer-events:none}.gtv-offset-badge{position:absolute;top:50%;transform:translate(-100%,-50%);margin-left:-4px;font-size:9px;font-weight:500;padding:2px 5px;border-radius:3px;white-space:nowrap;pointer-events:none;z-index:10}.gtv-offset-overlap,.gtv-offset-gap{background:var(--gtv-bg-card);border:1px solid var(--gtv-border);color:var(--gtv-text-muted)}.gtv-empty{display:flex;align-items:center;justify-content:center;padding:24px;color:var(--gtv-text-muted)}",$=[.25,.5,1,2,4],D="gsap-timeline-viewer-settings",A=40+16;class C extends HTMLElement{constructor(){super();o(this,"shadow");o(this,"timeline",null);o(this,"timelineData",null);o(this,"isPlaying",!1);o(this,"isLooping",!1);o(this,"speedIndex",2);o(this,"collapsed",!1);o(this,"height",200);o(this,"isDragging",!1);o(this,"manageBodyPadding",!0);o(this,"isAutofit",!1);o(this,"showEaseCurves",!1);o(this,"playrangeStart",0);o(this,"playrangeEnd",1);o(this,"draggingPlayrange",null);o(this,"container");o(this,"playBtn");o(this,"loopBtn");o(this,"speedBtn");o(this,"timeDisplay");o(this,"rulerInner");o(this,"tracksScroll");o(this,"playhead");o(this,"scrubArea");o(this,"resizeHandle");o(this,"timelineSelect");o(this,"isResizing",!1);this.shadow=this.attachShadow({mode:"open"}),this.loadSettings()}connectedCallback(){this.render(),this.setupEventListeners(),this.updateBodyPadding(),this.applyLoadedSettings()}loadSettings(){try{const t=localStorage.getItem(D);if(t){const e=JSON.parse(t);this.height=e.height??200,this.collapsed=e.collapsed??!1,this.speedIndex=e.speedIndex??2,this.isLooping=e.isLooping??!1,this.isAutofit=e.isAutofit??!1,this.showEaseCurves=e.showEaseCurves??!1,this.playrangeStart=e.playrangeStart??0,this.playrangeEnd=e.playrangeEnd??1}}catch{}}saveSettings(){var t;try{const e={height:this.height,collapsed:this.collapsed,speedIndex:this.speedIndex,isLooping:this.isLooping,isAutofit:this.isAutofit,showEaseCurves:this.showEaseCurves,selectedTimeline:(t=this.timelineSelect)==null?void 0:t.value,playrangeStart:this.playrangeStart,playrangeEnd:this.playrangeEnd};localStorage.setItem(D,JSON.stringify(e))}catch{}}applyLoadedSettings(){var t,e,i;this.collapsed&&this.container.classList.add("collapsed"),this.showEaseCurves&&(this.container.classList.add("show-ease-curves"),(t=this.shadow.querySelector('[data-action="ease-curves"]'))==null||t.classList.add("active")),this.isAutofit&&((e=this.shadow.querySelector('[data-action="autofit"]'))==null||e.classList.add("active")),this.isLooping&&((i=this.loopBtn)==null||i.classList.add("active")),this.speedBtn.textContent=`${$[this.speedIndex]}x`,this.container.style.height=`${this.height}px`,this.updatePlayrangeDisplay()}disconnectedCallback(){this.detachTimeline(),this.clearBodyPadding()}setTimeline(t){this.detachTimeline(),this.timeline=t,_(),this.timelineData=V(t),t.eventCallback("onUpdate",()=>this.onTimelineUpdate()),t.timeScale($[this.speedIndex]),t.repeat(this.isLooping?-1:0),this.renderTracks(),this.updatePlayhead(),this.updateTimeDisplay(),this.updatePlayState(),this.updatePlayrangeDisplay(),requestAnimationFrame(()=>this.applyAutofit())}updateTimelineSelector(){Promise.resolve().then(()=>q).then(({TimelineViewer:t})=>{const e=t.getTimelines(),i=this.timelineSelect.value;this.timelineSelect.innerHTML="",e.forEach((a,s)=>{const r=document.createElement("option");r.value=s,r.textContent=s,this.timelineSelect.appendChild(r)}),i&&e.has(i)&&(this.timelineSelect.value=i)})}setSelectedTimeline(t){this.timelineSelect.value=t,this.saveSettings()}detachTimeline(){this.timeline&&(this.timeline.eventCallback("onUpdate",null),this.timeline=null,this.timelineData=null)}render(){this.shadow.innerHTML=`
      <style>${O}</style>
      <div class="gtv-container ${this.collapsed?"collapsed":""}" style="height: ${this.height}px;">
        <!-- Resize Handle (at top of container) -->
        <div class="gtv-resize-handle"></div>

        <!-- Controls Bar -->
        <div class="gtv-controls">
          <div class="gtv-controls-left">
            <select class="gtv-timeline-select" title="Select timeline">
              <option value="">No timeline</option>
            </select>
            <button class="gtv-btn" data-action="loop" title="Loop (L)">
              <svg viewBox="0 0 24 24"><path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"/></svg>
            </button>
            <button class="gtv-btn gtv-speed-btn" data-action="speed" title="Playback speed">1x</button>
          </div>

          <div class="gtv-controls-center">
            <span class="gtv-time-display">
              <span class="gtv-time-current">0.00</span>
              <span class="gtv-time-total"> / 0.00</span>
            </span>
            <button class="gtv-btn" data-action="skip-start" title="Skip to start">
              <svg viewBox="0 0 24 24"><path d="M6 6h2v12H6V6zm3.5 6l8.5 6V6l-8.5 6z"/></svg>
            </button>
            <button class="gtv-btn gtv-btn-play" data-action="play" title="Play/Pause (Space)">
              <svg class="play-icon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
              <svg class="pause-icon" viewBox="0 0 24 24" style="display: none;"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
            </button>
            <button class="gtv-btn" data-action="skip-end" title="Skip to end">
              <svg viewBox="0 0 24 24"><path d="M6 18l8.5-6L6 6v12zm2 0V6l6.5 6L8 18zm8-12v12h2V6h-2z"/></svg>
            </button>
          </div>

          <div class="gtv-controls-right">
            <button class="gtv-btn" data-action="ease-curves" title="Show ease curves">
              <svg viewBox="0 0 24 24"><path d="M3 17c0 0 3-8 9-8s9 8 9 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            </button>
            <button class="gtv-btn" data-action="autofit" title="Auto-fit height">
              <svg viewBox="0 0 24 24"><path d="M4 8h4V4H4v4zm6 12h4v-4h-4v4zm-6 0h4v-4H4v4zm0-6h4v-4H4v4zm6 0h4v-4h-4v4zm6-10v4h4V4h-4zm-6 4h4V4h-4v4zm6 6h4v-4h-4v4zm0 6h4v-4h-4v4z"/></svg>
            </button>
            <button class="gtv-btn gtv-collapse-btn" data-action="collapse" title="Collapse/Expand">
              <svg viewBox="0 0 24 24"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg>
            </button>
          </div>
        </div>

        <!-- Playrange Bar (always visible) -->
        <div class="gtv-playrange-bar">
          <div class="gtv-playrange-track">
            <div class="gtv-playrange-inactive-left"></div>
            <div class="gtv-playrange-active"></div>
            <div class="gtv-playrange-inactive-right"></div>
          </div>
          <div class="gtv-playrange-handle gtv-playrange-handle-start" data-handle="start"></div>
          <div class="gtv-playrange-handle gtv-playrange-handle-end" data-handle="end"></div>
        </div>

        <!-- Timeline Area (hidden when collapsed) -->
        <div class="gtv-timeline-area">
          <!-- Ruler -->
          <div class="gtv-ruler">
            <div class="gtv-ruler-inner"></div>
          </div>

          <!-- Tracks -->
          <div class="gtv-tracks-container">
            <div class="gtv-tracks-scroll">
              <div class="gtv-scrub-area"></div>
            </div>
            <div class="gtv-empty">No timeline attached. Call setTimeline() to visualize a GSAP timeline.</div>
          </div>

          <!-- Playhead spans entire timeline area -->
          <div class="gtv-playhead-wrapper">
            <div class="gtv-playhead">
              <div class="gtv-playhead-head"></div>
              <div class="gtv-playhead-line"></div>
            </div>
          </div>
        </div>
      </div>
    `,this.container=this.shadow.querySelector(".gtv-container"),this.playBtn=this.shadow.querySelector('[data-action="play"]'),this.loopBtn=this.shadow.querySelector('[data-action="loop"]'),this.speedBtn=this.shadow.querySelector('[data-action="speed"]'),this.timeDisplay=this.shadow.querySelector(".gtv-time-display"),this.rulerInner=this.shadow.querySelector(".gtv-ruler-inner"),this.tracksScroll=this.shadow.querySelector(".gtv-tracks-scroll"),this.playhead=this.shadow.querySelector(".gtv-playhead"),this.scrubArea=this.shadow.querySelector(".gtv-scrub-area"),this.resizeHandle=this.shadow.querySelector(".gtv-resize-handle"),this.timelineSelect=this.shadow.querySelector(".gtv-timeline-select")}setupEventListeners(){this.shadow.addEventListener("click",t=>{const i=t.target.closest("[data-action]");if(!i)return;switch(i.dataset.action){case"play":this.togglePlay();break;case"skip-start":this.skipToStart();break;case"skip-end":this.skipToEnd();break;case"loop":this.toggleLoop();break;case"speed":this.cycleSpeed();break;case"collapse":this.toggleCollapse();break;case"autofit":this.toggleAutofit();break;case"ease-curves":this.toggleEaseCurves();break}i.blur()}),this.timelineSelect.addEventListener("change",()=>{const t=this.timelineSelect.value;t&&Promise.resolve().then(()=>q).then(({TimelineViewer:e})=>{var i;(i=e.getInstance())==null||i.select(t)})}),this.shadow.addEventListener("click",t=>{const i=t.target.closest(".gtv-track-bar");if(i){const a=i.closest(".gtv-track");(a==null?void 0:a.dataset.expandable)==="true"&&(t.stopPropagation(),a.classList.toggle("expanded"),requestAnimationFrame(()=>this.applyAutofit()))}}),this.scrubArea.addEventListener("mousedown",t=>this.startScrub(t)),this.shadow.querySelector(".gtv-ruler").addEventListener("mousedown",t=>this.startScrub(t)),this.shadow.querySelector(".gtv-tracks-container").addEventListener("mousedown",t=>{t.target.closest(".gtv-track-bar")||this.startScrub(t)}),document.addEventListener("mousemove",t=>{this.onScrub(t),this.onResize(t),this.onPlayrangeDrag(t)}),document.addEventListener("mouseup",()=>{this.endScrub(),this.endResize(),this.endPlayrangeDrag()}),this.resizeHandle.addEventListener("mousedown",t=>this.startResize(t)),this.shadow.querySelectorAll(".gtv-playrange-handle").forEach(t=>{t.addEventListener("mousedown",e=>this.startPlayrangeDrag(e))}),document.addEventListener("keydown",t=>{if(t.target===document.body)switch(t.code){case"Space":t.preventDefault(),this.togglePlay();break;case"KeyJ":t.preventDefault(),this.jumpToPrevPoint();break;case"KeyK":t.preventDefault(),this.jumpToNextPoint();break;case"KeyL":t.preventDefault(),this.toggleLoop();break}})}startScrub(t){this.timeline&&(t.preventDefault(),this.isDragging=!0,document.body.style.cursor="ew-resize",document.body.style.userSelect="none",this.scrubToPosition(t))}onScrub(t){!this.isDragging||!this.timeline||this.scrubToPosition(t)}endScrub(){this.isDragging=!1,document.body.style.cursor="",document.body.style.userSelect=""}startResize(t){t.preventDefault(),this.isResizing=!0,document.body.style.cursor="ns-resize",document.body.style.userSelect="none"}onResize(t){if(!this.isResizing)return;const e=window.innerHeight,i=e-t.clientY;this.height=Math.max(100,Math.min(i,e-100)),this.container.style.height=`${this.height}px`,this.updateBodyPadding()}endResize(){this.isResizing&&(this.isResizing=!1,document.body.style.cursor="",document.body.style.userSelect="",this.saveSettings())}startPlayrangeDrag(t){t.preventDefault(),t.stopPropagation();const e=t.target.closest(".gtv-playrange-handle");e&&(this.draggingPlayrange=e.dataset.handle,document.body.style.cursor="ew-resize",document.body.style.userSelect="none")}onPlayrangeDrag(t){if(!this.draggingPlayrange)return;const e=this.shadow.querySelector(".gtv-playrange-track");if(!e)return;const i=e.getBoundingClientRect(),s=Math.max(0,Math.min(t.clientX-i.left,i.width))/i.width;this.draggingPlayrange==="start"?this.playrangeStart=Math.min(s,this.playrangeEnd-.01):this.playrangeEnd=Math.max(s,this.playrangeStart+.01),this.updatePlayrangeDisplay()}endPlayrangeDrag(){this.draggingPlayrange&&(this.draggingPlayrange=null,document.body.style.cursor="",document.body.style.userSelect="",this.saveSettings())}updatePlayrangeDisplay(){const t=this.shadow.querySelector(".gtv-playrange-track"),e=this.shadow.querySelector(".gtv-playrange-handle-start"),i=this.shadow.querySelector(".gtv-playrange-handle-end"),a=this.shadow.querySelector(".gtv-playrange-active"),s=this.shadow.querySelector(".gtv-playrange-inactive-left"),r=this.shadow.querySelector(".gtv-playrange-inactive-right");if(t&&e&&i&&a&&s&&r){const c=this.playrangeStart*100,p=this.playrangeEnd*100,g=t.offsetLeft,u=t.offsetWidth;e.style.left=`${g+this.playrangeStart*u}px`,i.style.left=`${g+this.playrangeEnd*u}px`,a.style.left=`${c}%`,a.style.width=`${p-c}%`,s.style.width=`${c}%`,r.style.width=`${100-p}%`}}updateBodyPadding(){if(!this.manageBodyPadding)return;const t=this.collapsed?A:this.height;document.body.style.paddingBottom=`${t}px`}clearBodyPadding(){this.manageBodyPadding&&(document.body.style.paddingBottom="")}scrubToPosition(t){if(!this.timeline||!this.timelineData)return;const e=this.rulerInner.getBoundingClientRect(),a=Math.max(0,Math.min(t.clientX-e.left,e.width))/e.width;this.timeline.progress(a),this.timeline.pause(),this.updatePlayState()}togglePlay(){this.timeline&&(this.timeline.paused()||this.timeline.progress()===1?this.timeline.progress()===1?this.timeline.restart():this.timeline.play():this.timeline.pause(),this.updatePlayState())}skipToStart(){this.timeline&&(this.timeline.progress(0),this.timeline.pause(),this.updatePlayState())}skipToEnd(){this.timeline&&(this.timeline.progress(1),this.timeline.pause(),this.updatePlayState())}getTimePoints(){if(!this.timelineData)return[0];const t=new Set;return t.add(0),t.add(Math.round(this.timelineData.duration*1e3)/1e3),this.timelineData.tweens.forEach(e=>{t.add(Math.round(e.startTime*1e3)/1e3),t.add(Math.round(e.endTime*1e3)/1e3)}),Array.from(t).sort((e,i)=>e-i)}jumpToPrevPoint(){if(!this.timeline||!this.timelineData)return;const t=Math.round(this.timeline.time()*1e3)/1e3,e=this.getTimePoints(),i=this.playrangeStart*this.timelineData.duration;let a=i;for(const s of e)if(s<t-.001&&s>=i)a=s;else if(s>=t)break;this.timeline.time(Math.max(a,i)),this.timeline.pause(),this.updatePlayState()}jumpToNextPoint(){if(!this.timeline||!this.timelineData)return;const t=Math.round(this.timeline.time()*1e3)/1e3,e=this.getTimePoints(),i=this.playrangeEnd*this.timelineData.duration;let a=i;for(const s of e)if(s>t+.001&&s<=i){a=s;break}this.timeline.time(Math.min(a,i)),this.timeline.pause(),this.updatePlayState()}toggleLoop(){this.timeline&&(this.isLooping=!this.isLooping,this.timeline.repeat(this.isLooping?-1:0),this.loopBtn.classList.toggle("active",this.isLooping),this.saveSettings())}cycleSpeed(){if(!this.timeline)return;this.speedIndex=(this.speedIndex+1)%$.length;const t=$[this.speedIndex];this.timeline.timeScale(t),this.speedBtn.textContent=`${t}x`,this.saveSettings()}toggleCollapse(){this.collapsed=!this.collapsed,this.container.classList.toggle("collapsed",this.collapsed);const t=this.shadow.querySelector('[data-action="collapse"]');t.innerHTML=this.collapsed?'<svg viewBox="0 0 24 24"><path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6z"/></svg>':'<svg viewBox="0 0 24 24"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg>',this.updateBodyPadding(),this.saveSettings()}toggleAutofit(){this.isAutofit=!this.isAutofit,this.shadow.querySelector('[data-action="autofit"]').classList.toggle("active",this.isAutofit),this.isAutofit&&this.applyAutofit(),this.saveSettings()}toggleEaseCurves(){this.showEaseCurves=!this.showEaseCurves,this.shadow.querySelector('[data-action="ease-curves"]').classList.toggle("active",this.showEaseCurves),this.container.classList.toggle("show-ease-curves",this.showEaseCurves),this.saveSettings()}applyAutofit(){if(!this.isAutofit||this.collapsed)return;const t=this.shadow.querySelectorAll(".gtv-track");let e=0;const i=36,a=30;t.forEach(g=>{if(e+=i,g.classList.contains("expanded")){const u=g.querySelectorAll(".gtv-stagger-child");e+=u.length*a}});const s=24,r=16,c=100,p=window.innerHeight-100;this.height=Math.max(c,Math.min(A+s+e+r,p)),this.container.style.height=`${this.height}px`,this.updateBodyPadding()}updatePlayState(){if(!this.timeline)return;this.isPlaying=!this.timeline.paused()&&this.timeline.progress()<1;const t=this.playBtn.querySelector(".play-icon"),e=this.playBtn.querySelector(".pause-icon");t.style.display=this.isPlaying?"none":"block",e.style.display=this.isPlaying?"block":"none"}onTimelineUpdate(){this.updatePlayhead(),this.updateTimeDisplay(),this.updateActiveTracks(),this.updatePlayState(),this.checkPlayrangeConstraint()}checkPlayrangeConstraint(){if(!this.timeline||this.playrangeStart===0&&this.playrangeEnd===1||this.timeline.paused())return;const t=this.timeline.progress();t>=this.playrangeEnd?this.isLooping?this.timeline.progress(this.playrangeStart):(this.timeline.progress(this.playrangeEnd),this.timeline.pause(),this.updatePlayState()):t<this.playrangeStart&&this.timeline.progress(this.playrangeStart)}updatePlayhead(){if(!this.timeline||!this.timelineData)return;const t=this.timeline.progress();this.playhead.style.left=`${t*100}%`}updateTimeDisplay(){if(!this.timeline||!this.timelineData)return;const t=this.timeline.time(),e=this.timelineData.duration,i=this.timeDisplay.querySelector(".gtv-time-current"),a=this.timeDisplay.querySelector(".gtv-time-total");i.textContent=P(t),a.textContent=` / ${P(e)}`}updateActiveTracks(){if(!this.timeline||!this.timelineData)return;const t=this.timeline.time();this.tracksScroll.querySelectorAll(".gtv-track-bar").forEach((i,a)=>{const s=this.timelineData.tweens[a],r=t>=s.startTime&&t<=s.endTime,c=i.dataset.color;r?i.style.background=`var(--gtv-track-${c}-active)`:i.style.background=`var(--gtv-track-${c})`})}renderTracks(){if(!this.timelineData)return;const{duration:t,tweens:e}=this.timelineData,i=this.shadow.querySelector(".gtv-empty");i.style.display=e.length>0?"none":"flex",this.renderRuler(t);const a=this.renderGridLines(t),s=e.map(c=>this.renderTrack(c,t)).join(""),r=this.tracksScroll.querySelector(".gtv-scrub-area");this.tracksScroll.innerHTML=a+s,this.tracksScroll.prepend(r),this.scrubArea=r}renderGridLines(t){const e=[],i=this.calculateInterval(t);for(let a=0;a<=t;a+=i){const s=a/t*100;e.push(`<div class="gtv-grid-line" style="left: ${s}%;"></div>`)}return e.join("")}renderRuler(t){const e=[],i=this.calculateInterval(t);for(let a=0;a<=t;a+=i){const s=a/t*100;e.push(`
        <div class="gtv-ruler-marker" style="left: ${s}%;">
          <div class="gtv-ruler-marker-line"></div>
          <span class="gtv-ruler-marker-label">${P(a,!1)}s</span>
        </div>
      `)}this.rulerInner.innerHTML=e.join("")}calculateInterval(t){return t<=1?.25:t<=3?.5:t<=10?1:t<=30?5:10}renderEaseCurve(t){if(!(t!=null&&t.length))return"";const e=Math.min(...t),i=Math.max(...t),a=Math.min(0,e),s=Math.max(1,i),r=s-a||1,c=5,p=100-c*2,g=t.map((S,K)=>{const J=K/(t.length-1)*100,X=c+(s-S)/r*p;return{x:J,y:X}}),u=g.map(S=>`${S.x},${S.y}`).join(" L"),k=c+(s-0)/r*p,m=`M0,${k} L${u} L100,${k} Z`,f=`M${g.map(S=>`${S.x},${S.y}`).join(" L")}`,y=Math.random().toString(36).substr(2,9),x=`ease-grad-${y}`,L=`ease-clip-${y}`;return`
      <svg class="gtv-ease-curve" viewBox="0 0 100 100" preserveAspectRatio="none">
        <defs>
          <linearGradient id="${x}" x1="0" y1="0" x2="0" y2="1">
            <stop offset="0%" stop-color="var(--track-color)" stop-opacity="0.8" />
            <stop offset="100%" stop-color="var(--track-color)" stop-opacity="0" />
          </linearGradient>
          <clipPath id="${L}">
            <rect x="0" y="0" width="100" height="100" />
          </clipPath>
        </defs>
        <path class="gtv-ease-fill" d="${m}" fill="url(#${x})" clip-path="url(#${L})" />
        <path class="gtv-ease-stroke" d="${f}" />
      </svg>
    `}getEaseClipPath(t){return t!=null&&t.length?`polygon(0% 100%, ${t.map((i,a)=>{const s=a/(t.length-1)*100,r=100-i*100;return`${s}% ${r}%`}).join(", ")}, 100% 100%)`:""}renderTrack(t,e){const i=t.startTime/e*100,a=t.duration/e*100,s=t.colorIndex+1,c=[220,70,350,160,290,25][t.colorIndex%6],p=this.renderEaseCurve(t.easeSamples);let g="";t.hasStagger&&t.staggerChildren&&t.staggerChildren.length>0&&(g='<span class="gtv-track-stagger"><svg class="gtv-expand-icon" viewBox="0 0 24 24" width="10" height="10"><path fill="currentColor" d="M7 10l5 5 5-5z"/></svg> Stagger</span>');let u="";if(t.staggerChildren&&t.staggerChildren.length>0){const m=t.staggerChildren.map(f=>{const y=f.startTime/e*100,x=(f.endTime-f.startTime)/e*100;return`
          <div class="gtv-stagger-child">
            <div class="gtv-stagger-child-bar"
                 style="left: ${y}%; width: ${x}%; background: var(--gtv-track-${s}); --track-color: var(--gtv-track-${s}); --track-hue: ${c};">
              ${p}
              <span class="gtv-track-label">${f.targetLabel}</span>
            </div>
          </div>
        `}).join("");u=`<div class="gtv-stagger-children" data-for="${t.id}">${m}</div>`}let k="";if(t.overlapWithPrev!==void 0){const m=t.overlapWithPrev>0,f=Math.abs(t.overlapWithPrev)/e*100,y=m?`-${P(t.overlapWithPrev)}s`:`+${P(Math.abs(t.overlapWithPrev))}s`,x=this.getEaseClipPath(t.easeSamples);m?k=`
          <div class="gtv-overlap-region" style="left: ${i}%; width: ${f}%; --ease-clip: ${x};"></div>
          <span class="gtv-offset-badge gtv-offset-overlap" style="left: ${i}%;">${y}</span>
        `:k=`
          <div class="gtv-gap-connector" style="left: ${i-f}%; width: ${f}%;"></div>
          <span class="gtv-offset-badge gtv-offset-gap" style="left: ${i}%;">${y}</span>
        `}return`
      <div class="gtv-track" data-expandable="${t.hasStagger&&t.staggerChildren?"true":"false"}">
        ${k}
        <div class="gtv-track-bar"
             data-color="${s}"
             data-tween-id="${t.id}"
             style="left: ${i}%; width: ${a}%; background: var(--gtv-track-${s}); --track-color: var(--gtv-track-${s}); --track-hue: ${c};">
          ${p}
          <span class="gtv-track-label">${t.label}</span>
          ${g}
        </div>
        ${u}
      </div>
    `}}customElements.define("gsap-timeline-viewer",C);const b=new Map;let d=null,B=!0,W=0,M=null;const H=new WeakSet;let T=null;function U(){if(M)return M;const l=window;return l.gsap||l.GSAP||null}function I(){const l=U();if(!(l!=null&&l.globalTimeline))return;l.globalTimeline.getChildren(!1,!1,!0).forEach(t=>{if(H.has(t))return;H.add(t);const e=t.vars||{};let i;e.id&&typeof e.id=="string"?i=e.id:i=`Timeline ${++W}`;let a=i,s=1;for(;b.has(a);)a=`${i} (${++s})`;b.set(a,t),d&&(d.htmlElement.updateTimelineSelector(),b.size===1&&d.select(a))})}function Y(){T||(I(),T=setInterval(I,500))}function F(){T&&(clearInterval(T),T=null)}class E{constructor(n={}){o(this,"element");o(this,"currentTimelineName",null);this.element=document.createElement("gsap-timeline-viewer"),n.height&&this.element.style.setProperty("--viewer-height",`${n.height}px`)}static create(n={}){return d||(n.gsap&&(M=n.gsap,R(n.gsap)),B=n.autoDetect!==!1,d=new E(n),document.body.appendChild(d.element),B&&Y(),setTimeout(()=>{if(d.element.updateTimelineSelector(),n.defaultTimeline&&b.has(n.defaultTimeline))d.select(n.defaultTimeline);else if(b.size>0){const t=b.keys().next().value;t&&d.select(t)}},0),d)}static register(n,t){b.set(n,t),d&&(d.element.updateTimelineSelector(),b.size===1&&d.select(n))}static unregister(n){b.delete(n),d&&d.element.updateTimelineSelector()}static getTimelines(){return b}static getInstance(){return d}select(n){const t=b.get(n);t&&(this.currentTimelineName=n,this.element.setTimeline(t),this.element.setSelectedTimeline(n))}getCurrentTimelineName(){return this.currentTimelineName}destroy(){F(),this.element.remove(),d=null}get htmlElement(){return this.element}}const q=Object.freeze(Object.defineProperty({__proto__:null,TimelineViewer:E,TimelineViewerElement:C},Symbol.toStringTag,{value:"Module"}));v.TimelineViewer=E,v.TimelineViewerElement=C,Object.defineProperty(v,Symbol.toStringTag,{value:"Module"})});
